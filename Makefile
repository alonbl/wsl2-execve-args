WINCC = x86_64-w64-mingw32-gcc
CC = gcc

all: \
	dump-args-win.exe \
	dump-args \
	exec-args

clean:
	rm -f dump-args-win.exe dump-args exec-args
	rm -f *.out

deps:
	sudo apt install gcc gcc-mingw-w64

dump-args: dump-args.c
	$(CC) -o dump-args dump-args.c

dump-args-win.exe: dump-args.c
	$(WINCC) -o dump-args-win.exe dump-args.c

exec-args: exec-args.c
	$(CC) -o exec-args exec-args.c

check:	all
	@echo Native test
	./exec-args dump-args | tee dump-args.out
	@if ! grep -q arg0 dump-args.out; then echo FAILED; false; else echo PASS; fi
	@echo Windows test
	./exec-args dump-args-win.exe | tee dump-args-win.out
	@if ! grep -q arg0 dump-args-win.out; then echo FAILED; false; else echo PASS; fi
